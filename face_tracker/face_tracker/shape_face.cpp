#include "shape_face.hpp"
#include <opencv2/imgproc/imgproc.hpp>
#include <iostream>
#define fl at<float>
//≥ı ºªØ
shape_model::shape_model()
{
	V=(Mat_<float>(152,18)<< -1.65296733e-001, 6.72742724e-002, 1.14707865e-001,
             2.49980175e-010, -2.06561182e-002, 2.22706109e-001,
             2.10934743e-001, 1.45485537e-004, -6.02581501e-002,
             -8.97160321e-002, 3.61761753e-003, 1.53734922e-001,
             2.71166842e-002, -6.13583215e-002, -2.54985541e-002,
             -1.42898023e-001, 2.57187337e-001, 1.83866754e-001,
             -6.72742724e-002, -1.65296733e-001, -2.51060644e-010,
             1.14707865e-001, -1.22538984e-001, 3.01326625e-002,
             -2.70011113e-003, -9.29720029e-002, -6.71513230e-002,
             -3.06433141e-002, -3.96908894e-002, -5.90609619e-003,
             6.53684363e-002, 7.93078914e-002, 1.50601223e-001,
             -9.64548811e-002, -8.79230201e-002, -2.82180831e-002,
             -1.64978012e-001, 1.60028860e-002, 1.14707865e-001,
             1.67695496e-010, 2.53270734e-002, 2.82943130e-001,
             1.85433090e-001, -2.76991469e-003, -4.79351059e-002,
             -7.05841035e-002, -5.65736741e-003, 1.79270700e-001,
             -8.29084427e-004, -2.00984180e-002, -2.45947596e-002,
             -1.29610375e-001, 1.11013524e-001, 1.30474553e-001,
             -1.60028860e-002, -1.64978012e-001, -1.67258707e-010,
             1.14707865e-001, -6.10226057e-002, 3.56283709e-002,
             1.14393961e-002, -6.57758564e-002, -7.36983195e-002,
             -6.77187089e-003, -1.07423976e-001, 6.72027934e-003,
             -2.97039598e-002, 5.22986166e-002, 1.72483549e-001,
             -1.71788052e-001, -8.22976232e-002, -1.76775753e-001,
             -1.59681112e-001, -3.06803677e-002, 1.14707865e-001,
             8.84618628e-011, 7.67877847e-002, 2.96457142e-001,
             1.72974452e-001, -2.35849414e-002, -4.76242863e-002,
             -2.84356903e-002, -3.72407841e-003, 1.96132630e-001,
             -4.92075980e-002, -3.33290398e-002, 1.65284518e-002,
             -7.95221180e-002, 1.10612832e-001, 3.13192420e-002,
             3.06803677e-002, -1.59681112e-001, -8.66712535e-011,
             1.14707865e-001, 2.56483629e-002, 7.20966607e-003,
             1.62290595e-002, -5.23234196e-002, -3.69508564e-002,
             8.24707076e-002, -1.92846656e-001, -7.57768154e-002,
             -1.81748327e-002, -2.61064600e-002, 1.76115111e-001,
             -1.24963500e-001, -1.64715713e-003, -1.86150938e-001,
             -1.48966506e-001, -7.77749792e-002, 1.14707865e-001,
             3.90387896e-012, 1.86378717e-001, 3.21595222e-001,
             1.15472682e-001, -6.71817362e-002, -2.37005688e-002,
             8.06865394e-002, -2.33285632e-002, 1.25999853e-001,
             -6.79963976e-002, 1.61488540e-002, 3.97138819e-002,
             3.62680815e-002, -1.28582902e-002, -2.89813261e-002,
             7.77749792e-002, -1.48966506e-001, -7.77186854e-013,
             1.14707865e-001, 9.97325405e-002, 1.34701207e-002,
             2.91529484e-002, -3.47341225e-002, -5.58457859e-002,
             2.65940785e-001, -2.59514391e-001, -1.68356597e-001,
             -6.41281065e-003, 3.81001495e-002, 6.69267997e-002,
             -4.86643910e-002, -5.43506406e-002, -3.32867950e-002,
             -1.24983452e-001, -1.26513779e-001, 1.14707865e-001,
             -9.47123699e-011, 2.18742654e-001, 2.54248559e-001,
             8.71686488e-002, -8.11694488e-002, 4.73411335e-003,
             1.52079850e-001, -7.04764798e-002, 5.73196635e-002,
             -1.26373753e-001, 1.47472285e-002, 1.83713157e-002,
             2.25419655e-001, -1.46295503e-001, -1.08572312e-001,
             1.26513779e-001, -1.24983452e-001, 9.91506113e-011,
             1.14707865e-001, -8.75002816e-002, -4.65706736e-002,
             1.02066830e-001, 6.05236441e-002, -7.89664090e-002,
             2.12539718e-001, -2.73223817e-001, -7.24841189e-003,
             -3.00757424e-003, 4.92012613e-002, 9.06215608e-002,
             -6.03684597e-003, -1.57561377e-001, -7.56926984e-002,
             -8.93540084e-002, -1.57958075e-001, 1.14707865e-001,
             -1.75696763e-010, 1.54393271e-001, 1.22770175e-001,
             5.33230267e-002, -5.43172956e-002, 8.34624562e-003,
             1.47304028e-001, -8.16880539e-002, -9.32144653e-003,
             -1.26727447e-001, -1.09166622e-001, -3.76515239e-002,
             2.31129333e-001, -1.40882164e-001, -4.64534014e-002,
             1.57958075e-001, -8.93540084e-002, 1.80869861e-010,
             1.14707865e-001, -1.32558048e-001, -7.85667971e-002,
             1.51409984e-001, 8.75093266e-002, -2.43775826e-002,
             9.01396126e-002, -2.12163001e-001, 1.16112575e-001,
             4.97574136e-002, -2.09325124e-002, 8.97657648e-002,
             6.28254190e-002, -1.80205684e-002, 3.88007201e-002,
             -4.43429351e-002, -1.80292770e-001, 1.14707865e-001,
             -2.50190590e-010, 4.65878472e-002, -1.77299920e-002,
             1.79827753e-002, -2.32755169e-002, -9.40392260e-003,
             6.96535781e-002, -2.76807919e-002, -3.18904705e-002,
             -6.06299639e-002, -9.24565792e-002, -6.55161440e-002,
             9.60638896e-002, -6.32384326e-003, -1.07153887e-002,
             1.80292770e-001, -4.43429351e-002, 2.55776872e-010,
             1.14707865e-001, -9.26939026e-002, -6.77033290e-002,
             1.75312445e-001, 5.94162531e-002, 7.05042109e-002,
             7.94345606e-003, -1.62956640e-001, 1.75584540e-001,
             8.99932608e-002, -2.88848579e-002, 8.28993246e-002,
             2.05674469e-001, 6.20619245e-002, 7.30844662e-002,
             3.69058293e-003, -1.87625960e-001, 1.14707865e-001,
             -3.03292336e-010, -2.17384798e-003, -7.29609057e-002,
             2.56418600e-003, -1.29727004e-002, -8.79635476e-003,
             -2.02493602e-003, 2.61262208e-002, -4.69642167e-004,
             -3.66701372e-002, -3.44651006e-002, -9.57903117e-002,
             6.91746771e-002, 3.58729511e-002, 3.84202749e-002,
             1.87625960e-001, 3.69058317e-003, 3.08830711e-010,
             1.14707865e-001, -7.60053694e-002, -3.31690088e-002,
             1.89642474e-001, 5.18821403e-002, 1.10499464e-001,
             -5.57014830e-002, -1.19082995e-001, 1.93058193e-001,
             8.11101422e-002, -3.99677493e-002, 4.27758060e-002,
             2.67212480e-001, 8.45057666e-002, 3.26603577e-002,
             4.96583730e-002, -1.77637532e-001, 1.14707865e-001,
             -3.26908389e-010, -7.83186853e-002, 3.94145958e-003,
             -1.74636357e-002, 4.07699570e-002, -1.76144596e-002,
             4.59692143e-002, -5.94208278e-002, -3.94466296e-002,
             -5.05865663e-002, 8.14230938e-004, -1.17232084e-001,
             -1.74170509e-002, 5.21479137e-002, 1.02710083e-001,
             1.77637532e-001, 4.96583730e-002, 3.31897010e-010,
             1.14707865e-001, -1.02398530e-001, -6.09843712e-003,
             1.97644740e-001, 8.09084326e-002, 8.68209228e-002,
             -7.72929862e-002, -6.25174046e-002, 2.09290847e-001,
             5.30005544e-002, -6.17707670e-002, 7.46969180e-003,
             2.26257369e-001, 3.55011672e-002, 1.44517245e-002,
             8.52332041e-002, -1.52668282e-001, 1.14707865e-001,
             -3.17610493e-010, -2.02142924e-001, 6.96449727e-002,
             -1.75004825e-002, 1.19126201e-001, -2.46906839e-002,
             3.85124907e-002, -1.17135748e-001, -1.28432870e-001,
             -3.56563628e-002, -3.23016569e-002, -1.30014479e-001,
             -1.65084839e-001, 1.82827428e-001, 8.92030075e-002,
             1.52668282e-001, 8.52332041e-002, 3.21662919e-010,
             1.14707865e-001, -1.55013055e-001, 2.91787218e-002,
             1.96789354e-001, 1.25977054e-001, -1.70138404e-002,
             -8.55793133e-002, 4.55394574e-002, 1.77074730e-001,
             7.58891599e-003, 3.05530690e-002, -2.87214480e-002,
             9.63292345e-002, -1.06209368e-001, -8.41617435e-002,
             1.12488709e-001, -1.19925812e-001, 1.14707865e-001,
             -2.88713525e-010, -2.71995813e-001, 1.61077455e-001,
             -3.77043635e-002, 1.60733491e-001, -1.42697748e-002,
             -2.63553299e-002, -8.05524588e-002, -1.51236489e-001,
             1.77875941e-003, -3.88665013e-002, -1.15838483e-001,
             -1.74216449e-001, 1.23185553e-001, 3.70600782e-002,
             1.19925812e-001, 1.12488709e-001, 2.91645430e-010,
             1.14707865e-001, -9.62644592e-002, 3.61723043e-002,
             1.50454432e-001, 1.12216435e-001, -3.10264640e-002,
             -1.14651486e-001, 1.83314875e-001, 1.36480466e-001,
             -3.03358864e-002, 4.76110131e-002, -2.32111532e-002,
             3.50465835e-003, -1.46373540e-001, -9.57588926e-002,
             1.29193261e-001, -7.78981969e-002, 1.14707865e-001,
             -2.35876929e-010, -2.38609180e-001, 2.14495480e-001,
             -6.38336539e-002, 1.47711039e-001, 4.71929982e-002,
             -9.08100754e-002, 1.70004589e-003, -1.47489294e-001,
             4.93030697e-002, -4.53472324e-002, -8.47287029e-002,
             -6.17141239e-002, 3.70437019e-002, -8.83511442e-004,
             7.78981969e-002, 1.29193261e-001, 2.37471487e-010,
             1.14707865e-001, 6.37763664e-002, 2.88541266e-003,
             8.44808295e-002, 2.56091356e-002, -2.58743647e-003,
             -1.02075525e-001, 2.73195863e-001, 6.47268742e-002,
             -9.82499719e-002, -7.10986974e-003, -2.59623751e-002,
             2.14104354e-003, -8.35925117e-002, -2.97775082e-002,
             1.39485851e-001, -2.71101370e-002, 1.14707865e-001,
             -1.63505057e-010, -1.40114173e-001, 2.32153624e-001,
             -1.06385812e-001, 8.62497166e-002, 9.49631333e-002,
             -6.26319349e-002, 1.00819126e-001, -1.87673271e-001,
             1.83690395e-002, -3.09077241e-002, -4.60123010e-002,
             9.72358361e-002, -2.11036690e-002, 6.23870688e-003,
             2.71101370e-002, 1.39485851e-001, 1.63538086e-010,
             1.14707865e-001, -2.23869104e-002, -3.11835902e-003,
             5.67373335e-002, -7.43201142e-003, -4.93456572e-002,
             -8.32937285e-002, 7.78601989e-002, 1.00714386e-001,
             -2.27256924e-001, 6.03827573e-002, -7.06982538e-002,
             -1.18811153e-001, -1.31834701e-001, -2.95458078e-001,
             1.43883228e-001, 1.92882363e-002, 1.14707865e-001,
             -9.30769420e-011, -8.16387832e-002, 2.36224651e-001,
             -1.13419794e-001, 6.75102919e-002, 7.59393275e-002,
             -2.43432242e-002, 1.10365123e-001, -1.62250772e-001,
             -1.09452344e-002, 2.70065013e-002, -1.76780745e-002,
             1.11053675e-001, -2.54630670e-002, -7.84711912e-002,
             -1.92882363e-002, 1.43883228e-001, 9.17110693e-011,
             1.14707865e-001, -9.51142088e-002, -8.14156327e-003,
             4.10398468e-002, -4.56427485e-002, -8.79935995e-002,
             -4.85425778e-002, -5.11233555e-003, 7.66329765e-002,
             -2.09026828e-001, 1.02350749e-001, -7.71032870e-002,
             -9.08500701e-002, -1.25816971e-001, -2.06971347e-001,
             1.40999287e-001, 6.84657246e-002, 1.14707865e-001,
             -1.19320274e-011, -4.25096191e-002, 2.69807220e-001,
             -1.41987339e-001, 7.71549046e-002, 7.95926377e-002,
             2.53211912e-002, 1.07148170e-001, -1.61493197e-001,
             -6.54050242e-003, -9.20690410e-003, -3.14621180e-002,
             1.80971473e-001, -1.55407205e-001, -1.24172971e-001,
             -6.84657246e-002, 1.40999287e-001, 9.12511646e-012,
             1.14707865e-001, -1.43120900e-001, -2.57035401e-002,
             2.46216990e-002, -9.92705896e-002, -9.63114873e-002,
             2.05089175e-003, -2.34579816e-002, -7.46489875e-003,
             -1.00246213e-001, -4.91955318e-002, -4.27454449e-002,
             7.69470865e-003, 6.99978173e-002, 2.41138469e-002,
             1.19044304e-001, 9.99365672e-002, 1.14707865e-001,
             5.73167694e-011, -1.80064968e-003, 8.91117528e-002,
             -1.34425879e-001, -5.86910732e-002, -2.73025986e-002,
             1.39534622e-001, 1.99579187e-002, 8.86394754e-002,
             1.06931329e-001, -7.87491649e-002, -3.20810527e-002,
             1.15553755e-002, 2.20703818e-002, -1.82499811e-001,
             -9.99365672e-002, 1.19044304e-001, -6.09348336e-011,
             1.14707865e-001, -1.34320810e-001, -2.31038295e-002,
             -4.56752628e-003, 1.48137696e-002, 2.43456867e-002,
             2.42276520e-001, -8.48142896e-003, 6.57588840e-002,
             -2.83387024e-002, -1.51321262e-001, -1.08968221e-001,
             -1.33984521e-001, -3.45694870e-002, 1.68617100e-001,
             9.28181186e-002, 1.23049714e-001, 1.14707865e-001,
             1.16876037e-010, -7.75801670e-003, 4.14938852e-002,
             -1.03336975e-001, -9.44353342e-002, -5.45528121e-002,
             1.31224558e-001, 2.09084433e-002, 1.25659108e-001,
             1.53314233e-001, -1.35228306e-001, -6.19457709e-003,
             -5.82716241e-002, -8.26512054e-002, -3.90068144e-002,
             -1.23049714e-001, 9.28181186e-002, -1.21034044e-010,
             1.14707865e-001, -7.61991814e-002, -1.22582987e-002,
             -4.17230688e-002, 7.89753795e-002, 6.37115985e-002,
             1.89165935e-001, -2.49583200e-002, 4.64820899e-002,
             -5.06187640e-002, 1.52664809e-002, -1.29703134e-001,
             -6.78141043e-002, -3.74744572e-002, 8.57854113e-002,
             6.12762794e-002, 1.22011289e-001, 1.14707865e-001,
             1.42382564e-010, -2.51842383e-003, 1.34336706e-002,
             -6.81614503e-002, -1.01489648e-001, -7.41095394e-002,
             9.29817557e-002, -1.18852817e-002, 8.44996572e-002,
             1.75547078e-001, -8.96975100e-002, -3.47445393e-003,
             -1.12793170e-001, -1.76503748e-001, 2.59694066e-002,
             -1.22011289e-001, 6.12762794e-002, -1.46335680e-010,
             1.14707865e-001, -2.43443549e-002, -1.49690630e-002,
             -9.26933885e-002, 9.08396393e-002, 1.08728513e-001,
             1.73607051e-001, -7.45359284e-004, 3.38748358e-002,
             -6.44513741e-002, 8.61788169e-002, -1.17458537e-001,
             4.11190614e-002, 5.56514151e-002, -4.56338115e-002,
             3.19975279e-002, 1.02776863e-001, 1.14707865e-001,
             1.36834780e-010, 6.98389951e-003, -2.11482346e-002,
             -5.59050590e-002, -8.26841742e-002, -6.08269535e-002,
             2.14655846e-002, -1.62081886e-002, 4.36058156e-002,
             1.20424949e-001, -1.76230054e-002, 1.34860473e-002,
             -1.03199460e-001, -1.25748411e-001, 6.83622360e-002,
             -1.02776863e-001, 3.19975279e-002, -1.40056383e-010,
             1.14707865e-001, -1.01434225e-002, -1.83522180e-002,
             -1.20644636e-001, 9.35705379e-002, 1.24586456e-001,
             1.52079716e-001, 3.17230145e-003, 3.18816118e-002,
             -8.64288360e-002, 8.12371895e-002, -8.58589634e-002,
             9.85639691e-002, 1.39395893e-001, -1.50489762e-001,
             6.29857406e-002, 1.03805214e-001, 1.14707865e-001,
             1.11788995e-010, 7.07264291e-003, 6.64271181e-003,
             -8.18932354e-002, -1.00163594e-001, -6.28477857e-002,
             8.27223808e-002, -3.80950794e-003, 7.97373950e-002,
             1.54048219e-001, -5.21122366e-002, 7.53691001e-003,
             -8.47743005e-002, -1.18991606e-001, -1.38745122e-002,
             -1.03805214e-001, 6.29857406e-002, -1.15212159e-010,
             1.14707865e-001, -3.09946183e-002, -3.26414444e-002,
             -8.79541785e-002, 8.25487748e-002, 1.13495715e-001,
             2.02880263e-001, 6.09754212e-003, 4.98849787e-002,
             -4.26662974e-002, -1.08960827e-004, -8.70125294e-002,
             8.37742686e-002, 6.99211732e-002, 2.23273486e-002,
             9.15271193e-002, 1.04962341e-001, 1.14707865e-001,
             8.90566787e-011, 9.53441299e-003, 3.46088372e-002,
             -1.18029013e-001, -8.54594633e-002, -4.47589047e-002,
             1.25142023e-001, 7.32555799e-003, 1.02440082e-001,
             1.42399788e-001, -9.38070193e-002, -4.86543030e-003,
             -3.11218929e-002, -2.34408937e-002, -9.96845439e-002,
             -1.04962341e-001, 9.15271193e-002, -9.26717036e-011,
             1.14707865e-001, -6.67886809e-002, -2.58493964e-002,
             -5.05174398e-002, 8.30179155e-002, 9.68575478e-002,
             2.32162967e-001, -2.16932641e-003, 7.35453740e-002,
             -2.51041204e-002, -6.56752363e-002, -9.68356803e-002,
             6.25029067e-003, -4.56887372e-002, 1.58458441e-001,
             -1.25131428e-001, 9.67217013e-002, 1.14707865e-001,
             2.62487199e-010, -1.12939011e-002, 4.48984187e-003,
             1.11896992e-001, 1.21453866e-001, 5.81760071e-002,
             -1.11484028e-001, -1.02402136e-001, -1.12738900e-001,
             -9.97849405e-002, 1.86722025e-001, 7.20726401e-002,
             -4.98468988e-002, -1.57510176e-001, 1.90346807e-001,
             -9.67217013e-002, -1.25131428e-001, -2.64661848e-010,
             1.14707865e-001, -9.90966111e-002, -1.78677961e-002,
             -2.67942194e-002, 4.00025435e-002, 1.16009541e-001,
             7.40685165e-002, 1.67658523e-001, 1.23170979e-001,
             1.36515081e-001, -9.82530564e-002, 1.73166186e-001,
             -2.02962384e-001, -1.99941285e-002, 8.36719126e-002,
             -9.65818763e-002, 1.19907878e-001, 1.14707865e-001,
             2.74984008e-010, 2.08437555e-002, -4.06535789e-002,
             7.07784370e-002, 1.29264593e-001, 9.44609791e-002,
             -8.32006782e-002, -1.23145461e-001, -1.19933575e-001,
             -1.23990588e-001, 1.88335672e-001, 9.04035717e-002,
             1.74180549e-002, -6.92022592e-002, 4.93256338e-002,
             -1.19907878e-001, -9.65818763e-002, -2.78003232e-010,
             1.14707865e-001, -5.81346825e-002, 1.07317995e-002,
             -6.61946014e-002, 1.08151942e-001, 1.37097836e-001,
             3.49998437e-002, 9.03416127e-002, 9.44582596e-002,
             6.88982904e-002, 3.52559760e-002, 9.29301456e-002,
             -1.40454262e-001, -6.62555620e-002, 1.40259946e-002,
             -6.20788746e-002, 1.20543532e-001, 1.14707865e-001,
             2.46282744e-010, 2.09115446e-002, -8.12899768e-002,
             4.41861264e-002, 9.82352868e-002, 9.18070078e-002,
             -3.26494500e-002, -7.68002495e-002, -1.14598714e-001,
             -9.71398801e-002, 1.05228305e-001, 1.09558560e-001,
             2.98003815e-002, 4.65797558e-002, -3.44039202e-002,
             -1.20543532e-001, -6.20788746e-002, -2.49511273e-010,
             1.14707865e-001, -1.55054871e-002, 1.27959950e-002,
             -1.00347869e-001, 1.18132792e-001, 1.68887839e-001,
             6.02318570e-002, 9.32356864e-002, 6.55854121e-002,
             1.42063191e-002, 1.06733039e-001, 3.97212133e-002,
             -7.45430449e-003, 6.72634039e-003, -8.41348022e-002,
             -3.02504748e-002, 1.02868527e-001, 1.14707865e-001,
             1.90596677e-010, 1.98498275e-002, -8.31705332e-002,
             1.56668555e-002, 7.37198666e-002, 7.61694238e-002,
             3.75448540e-002, -3.30160633e-002, -5.19898944e-002,
             -1.68475080e-002, 3.58107202e-002, 1.24007173e-001,
             1.89022738e-002, 1.02759175e-001, -9.62663442e-002,
             -1.02868527e-001, -3.02504748e-002, -1.93477304e-010,
             1.14707865e-001, -3.87577130e-003, 6.30940020e-004,
             -1.23713240e-001, 1.05270609e-001, 1.68220624e-001,
             5.69674820e-002, 9.94100273e-002, 5.33015467e-002,
             -1.53406058e-002, 9.62589011e-002, 4.00778316e-002,
             6.86439946e-002, 1.23690225e-001, -1.85145810e-001,
             -6.36558458e-002, 1.02921374e-001, 1.14707865e-001,
             2.19453816e-010, 1.14843817e-002, -6.78554252e-002,
             4.89659719e-002, 9.76251066e-002, 8.36982727e-002,
             -2.51672026e-002, -7.54019096e-002, -9.23411772e-002,
             -6.26112670e-002, 1.12036996e-001, 1.17591195e-001,
             -5.93481725e-003, -9.02730320e-003, 1.39948521e-002,
             -1.02921374e-001, -6.36558458e-002, -2.22151575e-010,
             1.14707865e-001, -2.02103145e-002, -7.53351161e-003,
             -1.04579709e-001, 1.14918180e-001, 1.80998489e-001,
             7.93284029e-002, 1.03555791e-001, 8.36068392e-002,
             3.81157771e-002, 4.43628356e-002, 9.07683000e-002,
             2.76478808e-002, 9.40525439e-003, -4.49079014e-002,
             -9.46720466e-002, 1.03235006e-001, 1.14707865e-001,
             2.46670268e-010, 6.47692522e-003, -3.64744961e-002,
             7.88750648e-002, 1.13025382e-001, 7.43668005e-002,
             -6.79093748e-002, -1.13353379e-001, -1.06582835e-001,
             -8.53067562e-002, 1.64429396e-001, 1.01152092e-001,
             -2.47984659e-002, -1.00661658e-001, 8.67319703e-002,
             -1.03235006e-001, -9.46720466e-002, -2.49206072e-010,
             1.14707865e-001, -4.84814048e-002, -1.16345324e-002,
             -7.11389855e-002, 1.13409452e-001, 1.71902999e-001,
             7.46935457e-002, 1.16232254e-001, 1.18794322e-001,
             8.48529339e-002, -2.87333522e-002, 1.41803026e-001,
             -7.51209930e-002, -7.05939531e-002, 8.20190981e-002,
             -9.85844508e-002, 6.66727424e-002, 1.14707865e-001,
             1.91557603e-010, 9.56889149e-003, -2.21862011e-002,
             8.85290876e-002, 5.55243790e-002, 5.06858341e-002,
             -3.87693308e-002, -3.21982428e-002, -9.57867578e-002,
             9.98768210e-002, -1.68941051e-001, 1.84317678e-002,
             -1.30533557e-002, -1.31042063e-001, 1.19466549e-002,
             -6.66727424e-002, -9.85844508e-002, -1.92988556e-010,
             1.14707865e-001, -9.28317979e-002, 9.70110670e-003,
             -1.64452028e-002, -8.12793374e-002, -3.32067981e-002,
             -1.02562368e-001, 6.36896119e-002, -1.25112629e-003,
             3.52473520e-002, -1.36733323e-003, 1.23337306e-001,
             -1.12968665e-002, -3.69394347e-002, -3.33718285e-002,
             -7.25809559e-002, 8.08793455e-002, 1.14707865e-001,
             1.91884258e-010, 1.78029276e-002, -3.49800512e-002,
             5.66234402e-002, 3.84888574e-002, 4.57392707e-002,
             -4.16709967e-002, -4.37204279e-002, -9.38980803e-002,
             9.79055315e-002, -1.30104348e-001, 3.05690225e-002,
             4.03130893e-003, -2.36174054e-002, -5.19294813e-002,
             -8.08793455e-002, -7.25809559e-002, -1.93879690e-010,
             1.14707865e-001, -5.74935377e-002, 6.81243464e-003,
             -3.99955325e-002, -8.12744945e-002, 1.77451910e-003,
             -1.04871087e-001, 5.83091155e-002, -4.30242307e-002,
             4.58800793e-002, -7.07351863e-002, 9.55599621e-002,
             8.42292234e-002, -1.02102242e-001, -1.87925019e-004,
             -4.51488234e-002, 6.66077361e-002, 1.14707865e-001,
             1.45428614e-010, 1.40440874e-002, -1.39469691e-002,
             4.17013541e-002, 3.32760029e-002, 2.95234136e-002,
             -3.42609845e-002, -3.77956890e-002, -6.82562441e-002,
             1.01670258e-001, -6.15571588e-002, 4.25452041e-003,
             -2.42407597e-003, 8.26152042e-003, -1.21888697e-001,
             -6.66077361e-002, -4.51488234e-002, -1.47152679e-010,
             1.14707865e-001, -6.63398653e-002, 5.80917951e-003,
             -3.93045656e-002, -9.07526165e-002, -3.53631638e-002,
             -1.01894543e-001, 2.37270202e-002, -2.57681441e-002,
             2.13353764e-002, 5.77272195e-003, 5.89106493e-002,
             2.04174966e-002, 1.03933532e-002, 3.24966293e-003,
             -7.21861124e-002, 5.78657575e-002, 1.14707865e-001,
             1.54733226e-010, 8.99481401e-003, -2.51080859e-002,
             6.20600730e-002, 4.45601940e-002, 4.43763174e-002,
             -3.74115482e-002, -3.02670393e-002, -7.67899901e-002,
             1.01112314e-001, -1.10083699e-001, 3.08474135e-002,
             -5.00739506e-003, -7.07032382e-002, -6.52404651e-002,
             -5.78657575e-002, -7.21861124e-002, -1.56049021e-010,
             1.14707865e-001, -6.06461316e-002, 1.01765934e-002,
             -3.58341113e-002, -8.56341124e-002, -5.00828847e-002,
             -9.85849127e-002, 4.29230146e-002, -3.09665482e-002,
             3.54600251e-002, 4.13349569e-002, 7.46412948e-002,
             2.54875980e-002, 1.52428076e-002, -4.95089702e-002,
             -7.14182556e-002, 7.04673752e-002, 1.14707865e-001,
             1.74228534e-010, 8.45741015e-003, -1.31548261e-002,
             5.38310856e-002, 2.93590799e-002, 3.30400988e-002,
             -5.29246032e-002, -2.50929464e-002, -9.26974043e-002,
             1.06119417e-001, -1.36936128e-001, 4.60859761e-002,
             2.34083794e-002, -2.66334992e-002, -8.25968757e-002,
             -7.04673752e-002, -7.14182556e-002, -1.75921916e-010,
             1.14707865e-001, -6.83181584e-002, 6.46185316e-003,
             -3.10569908e-002, -8.26675594e-002, -2.51433756e-002,
             -1.14586525e-001, 3.83177362e-002, -3.73853929e-002,
             2.99433880e-002, -2.33949479e-002, 9.19661373e-002,
             3.80371213e-002, -2.57818457e-002, -1.27378115e-002,
             9.58473682e-002, 6.83981627e-002, 1.14707865e-001,
             2.68500309e-011, -7.40759727e-003, 5.06475642e-002,
             -9.59237590e-002, -6.58314750e-002, -3.52512635e-002,
             3.36842053e-002, -6.12877589e-003, 4.34954353e-002,
             -3.89850400e-002, 1.40994594e-001, 1.18035488e-001,
             3.06519233e-002, 1.45490214e-001, -1.46815255e-002,
             -6.83981627e-002, 9.58473682e-002, -2.94056342e-011,
             1.14707865e-001, -1.11362539e-001, -7.13662384e-003,
             3.53237428e-003, -1.04205869e-001, -8.96850750e-002,
             3.37053239e-002, -5.26784360e-002, -5.38138747e-002,
             -6.05470575e-002, -4.91540954e-002, -6.48641735e-002,
             5.24146408e-002, 1.86116230e-002, 3.65002826e-002,
             7.09440187e-002, 8.18853155e-002, 1.14707865e-001,
             6.98728297e-011, -9.02083889e-003, 2.96810828e-002,
             -7.68000782e-002, -6.72977716e-002, -2.99169943e-002,
             4.13097106e-002, -7.06549687e-003, 4.05768193e-002,
             -2.14464925e-002, 9.76578146e-002, 1.42700493e-001,
             1.94193125e-002, 8.98902118e-002, 4.11737449e-002,
             -8.18853155e-002, 7.09440187e-002, -7.26905203e-011,
             1.14707865e-001, -7.30067864e-002, -6.17596973e-003,
             -2.05725133e-002, -9.94646773e-002, -4.29082774e-002,
             -3.42376879e-003, -2.15309411e-002, -7.00231045e-002,
             -2.89221425e-002, -1.10455900e-001, -5.33213615e-002,
             1.31697178e-001, -4.88153622e-002, 4.61152904e-002,
             4.41815518e-002, 6.75117970e-002, 1.14707865e-001,
             6.99329067e-011, -8.02263897e-003, 1.46730067e-002,
             -5.94303682e-002, -5.81636541e-002, -2.27108113e-002,
             2.95257773e-002, 6.16104761e-003, 2.73233764e-002,
             -2.33861730e-002, 6.58730865e-002, 1.36625826e-001,
             1.37763005e-002, 2.81444751e-002, 9.08097178e-002,
             -6.75117970e-002, 4.41815518e-002, -7.21769866e-011,
             1.14707865e-001, -7.75723755e-002, 5.78039419e-003,
             -2.48295497e-002, -9.66073722e-002, -6.92666173e-002,
             -1.61718559e-002, -3.93599570e-002, -4.57629673e-002,
             -4.19097953e-002, 4.78342082e-003, -7.14836046e-002,
             5.04827574e-002, 5.39219845e-003, 1.80507600e-002,
             7.11317956e-002, 5.97099811e-002, 1.14707865e-001,
             3.42409538e-011, -3.09950393e-003, 3.59891579e-002,
             -7.96139166e-002, -6.71214014e-002, -2.85944715e-002,
             3.10279112e-002, -4.48520703e-004, 4.80989590e-002,
             -2.82178503e-002, 1.18529588e-001, 1.25790402e-001,
             6.03280962e-003, 7.90953711e-002, 4.08212617e-002,
             -5.97099811e-002, 7.11317956e-002, -3.64027038e-011,
             1.14707865e-001, -7.33535960e-002, 5.81084169e-004,
             -1.80451293e-002, -9.90211219e-002, -9.46478620e-002,
             1.33159449e-002, -3.25231366e-002, -6.15475215e-002,
             -3.86312604e-002, 8.69422033e-003, -7.35126510e-002,
             7.41438344e-002, 4.84307855e-002, 4.17754240e-003,
             7.11636916e-002, 7.12023601e-002, 1.14707865e-001,
             5.25958999e-011, -5.96348383e-003, 3.17461602e-002,
             -7.85573870e-002, -7.04523474e-002, -2.02585254e-002,
             2.30689086e-002, 7.82364886e-003, 3.28224190e-002,
             -2.92491820e-002, 7.72400126e-002, 1.64418906e-001,
             4.82738726e-002, 1.00513354e-001, 5.51726334e-002,
             -7.12023601e-002, 7.11636916e-002, -5.50982975e-011,
             1.14707865e-001, -8.35065320e-002, -5.51650673e-003,
             -1.47088189e-002, -1.00197315e-001, -7.21991211e-002,
             -2.18445828e-004, -4.20971215e-002, -6.97314888e-002,
             -4.32734005e-002, -5.14562018e-002, -5.84805533e-002,
             9.17084292e-002, 1.55384410e-002, 3.57899219e-002,
             -1.64285246e-002, 6.91920966e-002, 1.14707865e-001,
             1.24825095e-010, 9.41347238e-003, -6.43682107e-002,
             1.33771207e-002, 2.01090854e-002, 7.01511744e-003,
             -9.19699483e-003, -3.14656757e-002, -1.45623169e-003,
             2.44177487e-002, -5.44647733e-003, 6.69520721e-003,
             -3.10118068e-002, 5.86842448e-002, -7.80254602e-002,
             -6.91920966e-002, -1.64285246e-002, -1.26784305e-010,
             1.14707865e-001, -1.46022206e-002, -4.10027020e-002,
             -3.23906355e-002, -6.18822761e-002, 8.03831499e-003,
             -1.14564843e-001, -1.66512504e-002, -4.82732877e-002,
             3.20393452e-003, -6.37115464e-002, 2.51629557e-002,
             8.99413377e-002, 2.18613401e-001, -3.42443921e-002,
             -2.04179827e-002, 2.46094316e-002, 1.14707865e-001,
             5.69499135e-011, 1.48005355e-002, -1.06908180e-001,
             8.95420089e-003, 1.09797670e-003, -9.68751963e-003,
             1.60795785e-002, -2.09191479e-002, -5.10087283e-003,
             4.95942980e-002, -1.74245723e-002, 5.93835115e-003,
             -4.38316427e-002, 8.47058073e-002, -6.14156760e-002,
             -2.46094316e-002, -2.04179827e-002, -5.75662712e-011,
             1.14707865e-001, 1.02743573e-001, 1.12509597e-002,
             -9.61400494e-002, 2.13015042e-002, -2.41127927e-002,
             -1.41618595e-001, -7.77024329e-002, 3.49626280e-002,
             1.19339071e-001, 7.96413049e-002, -8.84699449e-002,
             -1.76994465e-002, 6.81920275e-002, -5.78911277e-004,
             -4.48611304e-002, -2.64196726e-003, 1.14707865e-001,
             3.44137496e-011, 3.24269235e-002, -9.96162072e-002,
             5.19142821e-002, 5.07332757e-002, -6.68844953e-002,
             -3.02884472e-003, -2.11981256e-002, 1.35557633e-002,
             8.77096504e-002, -3.80170010e-002, -1.70453861e-002,
             -7.04186931e-002, 2.01594204e-001, -2.04946205e-001,
             2.64196726e-003, -4.48611304e-002, -3.40877812e-011,
             1.14707865e-001, 6.81892186e-002, 5.93023710e-002,
             -5.64545766e-002, 7.39082769e-002, -1.07769899e-001,
             -8.14845040e-002, -8.61116648e-002, 5.67883588e-002,
             1.21801786e-001, 2.34937921e-001, -1.67609915e-001,
             -1.07685961e-001, -1.21848159e-001, -9.27629694e-003,
             -3.28396074e-002, -2.25352161e-002, 1.14707865e-001,
             -7.76046675e-012, 1.98871903e-002, -7.54535943e-002,
             5.88677116e-002, 4.75581586e-002, -9.39301252e-002,
             8.65266751e-003, 7.74084497e-003, 2.96356119e-002,
             9.12931561e-002, 9.24617872e-002, -1.06568448e-001,
             -8.34604949e-002, 1.00002155e-001, -2.28388965e-001,
             2.25352161e-002, -3.28396074e-002, 8.60942914e-012,
             1.14707865e-001, 8.74134749e-002, 5.62407263e-003,
             -5.80514595e-002, 4.78643142e-002, -6.48691505e-002,
             -6.33015484e-002, -1.45250298e-002, -1.12230880e-002,
             9.05462429e-002, 8.31620023e-002, -5.20991646e-002,
             -6.50438364e-004, 7.85022136e-003, 4.98733036e-002,
             5.62006980e-003, -2.91545987e-002, 1.14707865e-001,
             -5.14743526e-011, 1.46104209e-002, -1.22042544e-001,
             -4.90461383e-003, -1.66419167e-002, -9.13817156e-003,
             -1.26860151e-002, 1.86254252e-002, 3.87225561e-002,
             -4.71914373e-003, -1.62985944e-003, -3.64000238e-002,
             -1.55997882e-002, 6.48098765e-003, -6.83341455e-003,
             2.91545987e-002, 5.62006980e-003, 5.23070753e-011,
             1.14707865e-001, 1.41637728e-001, 2.37823110e-002,
             -1.20708451e-001, 5.56650013e-002, 9.81166307e-003,
             -9.91541818e-002, -1.00099355e-001, 3.48324664e-002,
             6.19586147e-002, 2.46840194e-002, -7.10011646e-002,
             8.16161931e-003, -5.43175172e-003, 5.15841171e-002,
             3.98004539e-002, -2.18730439e-002, 1.14707865e-001,
             -6.92674321e-011, 5.79571910e-003, -8.80554542e-002,
             -6.65277988e-002, -6.18940182e-002, 7.61887208e-002,
             -4.88700271e-002, 4.71547525e-003, 7.51404616e-004,
             -9.06541497e-002, -6.45643100e-002, 9.05439928e-002,
             3.48299509e-003, -7.50423297e-002, 1.71949938e-001,
             2.18730439e-002, 3.98004539e-002, 6.96957006e-011,
             1.14707865e-001, 7.56082013e-002, 1.64818799e-003,
             -5.23242354e-002, 4.18741964e-002, -7.12062344e-002,
             -2.39060186e-002, -5.47156967e-002, -3.70743237e-002,
             6.84940219e-002, 5.53628579e-002, -8.83042812e-002,
             -1.72482186e-003, 2.77719796e-002, 5.06410189e-002,
             4.93510254e-002, -2.72505963e-003, 1.14707865e-001,
             -4.68656988e-011, -1.70779377e-002, -2.84883585e-002,
             -6.15803860e-002, -5.51789105e-002, 4.61787395e-002,
             -3.04183010e-002, 2.51553617e-002, 2.91472320e-002,
             -5.94823211e-002, 7.16232583e-002, 1.13013294e-002,
             -7.65135139e-003, -2.19061047e-001, 1.81003645e-001,
             2.72505963e-003, 4.93510254e-002, 4.66739494e-011,
             1.14707865e-001, 5.90869859e-002, 8.43440220e-002,
             -5.20321801e-002, 6.94832057e-002, -1.18086696e-001,
             -5.30858673e-002, -1.15555003e-001, 2.30675451e-002,
             9.63046104e-002, 2.30786726e-001, -2.01269791e-001,
             -8.19913670e-002, -1.95136547e-001, 1.68059748e-002,
             2.49567851e-002, 2.82830410e-002, 1.14707865e-001,
             2.37439044e-011, 1.80918369e-002, -9.93720144e-002,
             -2.88805030e-002, -1.27267092e-002, 2.89559085e-003,
             -1.86651517e-002, -1.58406347e-002, 2.72261649e-002,
             -3.92101146e-003, 2.38562729e-002, 1.16022825e-002,
             -4.61112224e-002, -7.32698385e-003, -2.48853071e-003,
             -2.82830410e-002, 2.49567851e-002, -2.47196291e-011,
             1.14707865e-001, 1.01389371e-001, 3.81847541e-003,
             -1.03910334e-001, 3.42933345e-003, -3.56750228e-002,
             -1.15727626e-001, -1.10391371e-001, 2.49496643e-002,
             1.10863186e-001, 8.53039995e-002, -1.00683868e-001,
             -7.65568204e-003, 9.31046084e-002, -1.23475743e-002,
             1.80943906e-002, 7.05796480e-002, 1.14707865e-001,
             9.73093481e-011, 1.23757282e-002, -7.06311539e-002,
             -1.60355642e-002, -4.10886258e-002, 1.26120495e-003,
             2.53685042e-002, -5.51482616e-003, -9.54331481e-004,
             1.84386820e-002, 1.47367513e-003, 3.83247472e-002,
             -1.42768128e-002, 2.05862634e-002, 2.20172126e-002,
             -7.05796480e-002, 1.80943906e-002, -9.95002830e-011,
             1.14707865e-001, -1.45192780e-002, -3.67687978e-002,
             -3.98946479e-002, -6.26872480e-002, -4.93602408e-003,
             -9.61820185e-002, -2.83175688e-002, -4.61562015e-002,
             -5.11484826e-003, -5.21397293e-002, 5.73207205e-003,
             7.72742778e-002, 2.08354354e-001, -4.57316376e-002,
             -1.92170665e-002, -1.49217024e-002, 1.14707865e-001,
             -7.31574176e-012, 3.61289061e-003, -1.23078264e-001,
             4.23741490e-002, 2.77655968e-003, -6.17769845e-002,
             1.25128021e-002, 5.47262141e-003, -1.13027927e-003,
             3.81153934e-002, 2.14500297e-002, -3.26904543e-002,
             -6.59918487e-002, 9.89026353e-002, -1.35402963e-001,
             1.49217024e-002, -1.92170665e-002, 7.86392566e-012,
             1.14707865e-001, 1.46920577e-001, 2.25611795e-002,
             -1.18288338e-001, 4.65359613e-002, 9.76553839e-003,
             -1.25030398e-001, -9.48743746e-002, 3.81836109e-002,
             1.32514387e-001, 3.60343643e-002, -5.27289137e-002,
             4.20203805e-002, -5.84885571e-003, 8.39525387e-002,
             2.95450818e-002, -1.42575083e-002, 1.14707865e-001,
             -4.82530127e-011, 3.11910678e-002, -1.16082542e-001,
             -6.18883744e-002, -3.96887362e-002, 5.09208180e-002,
             -3.35332900e-002, 2.03531818e-004, 4.96880598e-002,
             -1.43028134e-002, -8.91315844e-003, 3.14286090e-002,
             -1.86760235e-003, -7.70223662e-002, 1.03817597e-001,
             1.42575083e-002, 2.95450818e-002, 4.85122845e-011,
             1.14707865e-001, 1.41246259e-001, 7.01462571e-003,
             -1.12720475e-001, 4.02521640e-002, 2.66910676e-004,
             -9.90112722e-002, -1.27057895e-001, 2.05496084e-002,
             1.13494851e-001, 1.86951719e-002, -7.16559142e-002,
             3.77976447e-002, 7.71699520e-003, 8.83993730e-002,
             -5.81411533e-002, -7.79130906e-002, 1.14707865e-001,
             -7.45464593e-011, 1.08231287e-002, -2.94673666e-002,
             1.42961159e-001, 4.44554426e-002, -1.19081706e-001,
             9.12299231e-002, 2.33557165e-001, -9.19926167e-002,
             2.04142436e-001, 1.42715797e-001, -6.33132607e-002,
             1.37500301e-001, 2.33874507e-002, 4.55356464e-002,
             7.79130906e-002, -5.81411533e-002, 7.71757727e-011,
             1.14707865e-001, 1.30025102e-002, -1.01802340e-002,
             9.48140249e-002, 4.71281782e-002, -1.15253918e-001,
             6.12219013e-002, 1.53183371e-001, -5.89714460e-002,
             8.23498983e-003, 8.70253593e-002, 2.62564588e-002,
             -5.10886274e-002, -1.65104140e-002, 8.31602141e-002,
             -3.26500349e-002, -6.06753826e-002, 1.14707865e-001,
             -6.89301324e-011, 2.42424365e-002, -8.54133442e-002,
             5.52976727e-002, 2.26225443e-002, -7.75000080e-002,
             2.73375865e-002, 1.27299309e-001, -2.09173728e-002,
             7.22952262e-002, 4.13120240e-002, -5.69640808e-002,
             8.66575092e-002, 2.75802147e-002, 1.81063563e-002,
             6.06753826e-002, -3.26500349e-002, 7.09080156e-011,
             1.14707865e-001, 1.20068967e-001, -7.73635367e-003,
             -1.41277360e-002, 1.40471265e-001, -1.32519722e-001,
             2.05469318e-003, 8.77515525e-002, -2.63720974e-002,
             -6.84364066e-002, -1.02546424e-001, 7.37040713e-002,
             -2.28513684e-002, 4.10206057e-002, -4.67016222e-003,
             -8.79942533e-003, -5.48121259e-002, 1.14707865e-001,
             -8.00946115e-011, 1.29854307e-002, -1.10941947e-001,
             1.59653593e-002, -1.96360108e-002, -2.95908526e-002,
             -1.07807561e-003, 5.09666987e-002, 3.06017678e-002,
             7.96740036e-003, 2.61823833e-002, -6.77971467e-002,
             2.44468376e-002, -7.49313040e-003, 1.03741065e-002,
             5.48121259e-002, -8.79942533e-003, 8.17670931e-011,
             1.14707865e-001, 1.57687217e-001, 5.90468664e-003,
             -6.13242947e-002, 1.78958371e-001, -1.03705227e-001,
             -3.37220840e-002, 2.72330716e-002, -1.18358769e-002,
             -1.02918260e-001, -1.61562696e-001, 5.37391454e-002,
             -3.82835865e-002, 2.06794739e-002, -1.83492023e-002,
             5.81641309e-003, -5.67407981e-002, 1.14707865e-001,
             -9.57684626e-011, 1.18220206e-002, -1.12844743e-001,
             1.35171914e-003, -2.01061144e-002, -1.34557709e-002,
             -1.53823961e-002, 4.42303643e-002, 4.23231944e-002,
             -3.10377255e-002, 8.07895232e-003, -5.71525320e-002,
             7.37670297e-003, -1.00902421e-002, 1.66152362e-002,
             5.67407981e-002, 5.81641309e-003, 9.74173797e-011,
             1.14707865e-001, 1.63938895e-001, -1.38568860e-002,
             -6.06952272e-002, 1.72375962e-001, -8.91617388e-002,
             -3.44817974e-002, 2.65968069e-002, -2.14709770e-002,
             -1.13272868e-001, -2.15049386e-001, 7.19669834e-002,
             -3.12381368e-002, 4.96827289e-002, 7.56979827e-003,
             1.87939107e-002, -5.38917482e-002, 1.14707865e-001,
             -1.02389056e-010, 1.27881663e-002, -1.13045260e-001,
             -1.35576846e-002, -1.61887687e-002, -8.02737568e-003,
             -2.34701969e-002, 3.83999199e-002, 4.14700098e-002,
             -8.35637674e-002, -3.15905102e-002, -4.49112989e-002,
             -1.64709166e-002, 3.67907737e-003, 1.46698905e-002,
             5.38917482e-002, 1.87939107e-002, 1.03881917e-010,
             1.14707865e-001, 1.56981707e-001, 2.42423452e-003,
             -6.20243065e-002, 1.80801585e-001, -1.09384485e-001,
             -2.84874588e-002, 1.65284369e-002, -1.82717200e-002,
             -1.13689139e-001, -1.63172975e-001, 4.66902256e-002,
             -4.97763939e-002, 1.82313714e-002, -2.29112208e-002,
             4.12441418e-002, -5.95650524e-002, 1.14707865e-001,
             -1.30800440e-010, -1.14789149e-002, -7.18625933e-002,
             -4.63464595e-002, -4.10875604e-002, 5.82389832e-002,
             -7.91025683e-002, -1.64019056e-002, 7.76081458e-002,
             -1.54360577e-001, -3.36688720e-002, -5.66198640e-002,
             -6.02483228e-002, -1.29255829e-002, -3.13819922e-003,
             5.95650524e-002, 4.12441418e-002, 1.32337433e-010,
             1.14707865e-001, 1.12762667e-001, -5.79500012e-003,
             -7.69648934e-003, 1.55787826e-001, -1.45452306e-001,
             3.91435809e-002, 4.43383902e-002, -5.09477369e-002,
             -1.16307423e-001, -1.28044784e-001, 4.56090942e-002,
             -7.30289221e-002, 4.75398898e-002, -8.13746173e-003,
             6.18709996e-002, -7.53120854e-002, 1.14707865e-001,
             -1.73754594e-010, -1.89518966e-002, 1.10263713e-002,
             -1.18158728e-001, -3.09405103e-002, 9.84526053e-002,
             -1.45840079e-001, -7.90701285e-002, 1.34717882e-001,
             -2.38491520e-001, -1.13538317e-001, -5.89976273e-002,
             -9.35242772e-002, -6.03303052e-002, -2.14189198e-002,
             7.53120854e-002, 6.18709996e-002, 1.75644208e-010,
             1.14707865e-001, -3.11308051e-003, -1.96243823e-002,
             1.14888780e-001, 5.08938432e-002, -1.44654378e-001,
             1.19767308e-001, 9.49586555e-002, -1.03917420e-001,
             -4.01761718e-002, 5.81983589e-002, 2.97863167e-002,
             -9.25511047e-002, -3.11623677e-003, 9.71788540e-002,
             4.81018461e-002, -9.31589827e-002, 1.14707865e-001,
             -1.90441635e-010, -6.15189038e-003, -3.27755176e-002,
             -6.43839613e-002, -9.06325281e-002, 1.36833951e-001,
             -1.01699293e-001, -3.30046117e-002, 5.97432330e-002,
             -1.50971696e-001, -6.53708279e-002, -9.28182155e-002,
             -4.30494249e-002, -3.21824402e-002, 1.62616633e-002,
             9.31589827e-002, 4.81018461e-002, 1.92936042e-010,
             1.14707865e-001, 4.53369915e-002, 2.33796472e-003,
             1.21040329e-001, -8.76627862e-002, 6.64268956e-002,
             8.10905471e-002, 7.90674612e-002, -1.24705628e-001,
             -2.51419339e-002, 5.31797931e-002, -2.40414757e-002,
             -9.07327831e-002, 2.22906191e-002, 6.05664179e-002,
             2.86645647e-002, -1.02873348e-001, 1.14707865e-001,
             -1.89238417e-010, 7.93982670e-003, -6.75382540e-002,
             -3.09453234e-002, -6.96457922e-002, 6.92304447e-002,
             -4.85134013e-002, 1.70714967e-002, 4.02383506e-002,
             -9.53065380e-002, -2.28172820e-002, -1.06745027e-001,
             -1.14470078e-002, -8.47484637e-003, 1.46360546e-002,
             1.02873348e-001, 2.86645647e-002, 1.92127939e-010,
             1.14707865e-001, 9.70904157e-002, 8.84123612e-003,
             1.24659926e-001, -1.94426060e-001, 2.13675305e-001,
             5.28140180e-002, 6.91747963e-002, -1.36245817e-001,
             2.64738593e-002, 2.86035705e-002, -5.37312366e-002,
             -6.52596429e-002, 3.89880165e-002, 4.63116802e-002,
             5.57450717e-003, -1.05887726e-001, 1.14707865e-001,
             -1.74172149e-010, 4.45041619e-003, -8.90758932e-002,
             -1.68355438e-003, -1.89018529e-002, -1.56151550e-002,
             -1.52312452e-002, 5.71058206e-002, 3.71909514e-002,
             -4.21407893e-002, 2.02489942e-002, -9.16920230e-002,
             3.03202886e-002, -3.14239487e-002, 1.59588922e-002,
             1.05887726e-001, 5.57450717e-003, 1.77278470e-010,
             1.14707865e-001, 1.18997268e-001, 1.66696720e-002,
             1.23264790e-001, -2.25186855e-001, 2.45465085e-001,
             3.69797125e-002, 6.86141625e-002, -1.33832619e-001,
             5.81363179e-002, 3.10045239e-002, -6.97158277e-002,
             -6.40117005e-002, 5.52511588e-002, 2.81011295e-002,
             -2.02799886e-002, -1.04065165e-001, 1.14707865e-001,
             -1.48987989e-010, -4.51696524e-003, -7.86670595e-002,
             3.44512947e-002, 3.79743427e-002, -1.05334491e-001,
             2.76484638e-002, 9.23740342e-002, 1.96383093e-002,
             1.38660604e-002, 6.57760128e-002, -8.38971883e-002,
             6.59734756e-002, -4.53163125e-002, 1.40960347e-002,
             1.04065165e-001, -2.02799886e-002, 1.52183058e-010,
             1.14707865e-001, 1.04268543e-001, 1.41499471e-002,
             1.19676806e-001, -1.96589530e-001, 2.20001757e-001,
             3.33592966e-002, 7.95831755e-002, -1.19920790e-001,
             5.36000356e-002, 4.37999666e-002, -5.89742102e-002,
             -6.87996894e-002, 2.92955041e-002, 3.59156504e-002,
             -4.25798595e-002, -9.54934508e-002, 1.14707865e-001,
             -1.16070001e-010, -2.89777224e-003, -5.88559322e-002,
             7.05307722e-002, 8.09845850e-002, -1.70438126e-001,
             6.62626848e-002, 1.59791887e-001, -2.37657558e-002,
             9.22480300e-002, 8.94033909e-002, -6.06142431e-002,
             1.04014739e-001, -4.52812575e-003, 1.78668704e-002,
             9.54934508e-002, -4.25798595e-002, 1.19134244e-010,
             1.14707865e-001, 5.43670282e-002, 9.93415806e-003,
             1.11319050e-001, -9.11210030e-002, 8.42206478e-002,
             3.68884243e-002, 9.21387449e-002, -8.29008222e-002,
             3.49316932e-002, 7.75205940e-002, -3.49113233e-002,
             -7.70961940e-002, -7.34689133e-003, 4.05604914e-002,
             -2.31898557e-002, -8.37075114e-002, 1.14707865e-001,
             -1.13918958e-010, 6.23438787e-003, -5.98539636e-002,
             5.57107329e-002, 1.82577148e-002, -7.53722712e-002,
             5.55572882e-002, 8.75161067e-002, -2.93087810e-002,
             4.01012860e-002, 8.67706537e-002, -7.14460686e-002,
             6.72051683e-002, -4.94576944e-003, 8.63312371e-003,
             8.37075114e-002, -2.31898557e-002, 1.16526969e-010,
             1.14707865e-001, 8.42447877e-002, 1.21477619e-002,
             9.94044691e-002, -6.85212463e-002, 1.36180937e-001,
             -2.64676567e-002, -3.88075900e-003, -2.64171194e-002,
             8.38616956e-003, 3.38400365e-003, -5.93907386e-002,
             -1.07953228e-001, 5.26067205e-002, -6.82565421e-002,
             5.22858230e-003, -8.69224668e-002, 1.14707865e-001,
             -1.43538653e-010, 6.61568623e-003, -8.81212801e-002,
             9.15807032e-004, -1.28768347e-002, -2.22272500e-002,
             -1.40605597e-002, 5.27866483e-002, 4.04583849e-002,
             -4.14764024e-002, 1.47835501e-002, -6.75173625e-002,
             2.88232584e-002, -3.47393155e-002, 1.41434986e-002,
             8.69224668e-002, 5.22858230e-003, 1.46085019e-010,
             1.14707865e-001, 9.96921435e-002, 1.68318842e-002,
             9.98627171e-002, -9.11597908e-002, 1.67661920e-001,
             -2.04107147e-002, -1.58931762e-002, -2.17980463e-002,
             5.68648335e-003, -1.89993586e-002, -8.14047381e-002,
             -9.22010839e-002, 5.19376099e-002, -7.89762661e-002,
             3.20928656e-002, -8.26704055e-002, 1.14707865e-001,
             -1.59876029e-010, -2.44113198e-003, -6.84127584e-002,
             -5.06246090e-002, -3.82471196e-002, 6.29133657e-002,
             -8.06064755e-002, -2.47253589e-002, 8.72980058e-002,
             -1.23171665e-001, -5.82871810e-002, -6.59888163e-002,
             -3.35714258e-002, -2.08371095e-002, 3.84458085e-003,
             8.26704055e-002, 3.20928656e-002, 1.62148087e-010,
             1.14707865e-001, 7.29989782e-002, 1.41295334e-002,
             1.05073869e-001, -6.25132844e-002, 1.16599493e-001,
             -3.43426969e-003, -1.12018054e-002, -4.26048823e-002,
             -2.23786049e-002, 7.38176890e-003, -9.44440439e-002,
             -1.26757935e-001, 4.71499525e-002, -6.50542974e-002,
             3.20016704e-002, -7.07344562e-002, 1.14707865e-001,
             -1.40705558e-010, -5.76479081e-003, -7.52512440e-002,
             -4.97321412e-002, -3.31475027e-002, 5.46518303e-002,
             -7.90473074e-002, -1.96711961e-002, 8.64481479e-002,
             -1.28075078e-001, -6.73077330e-002, -5.69823422e-002,
             -4.01455089e-002, -1.05012143e-002, 1.04266098e-002,
             7.07344562e-002, 3.20016704e-002, 1.42624482e-010,
             1.14707865e-001, 1.07800812e-001, -8.26136395e-003,
             2.30115233e-003, 5.88955991e-002, -1.20806053e-001,
             5.21667711e-002, 8.75474811e-002, -8.88832584e-002,
             -7.89870098e-002, -7.48975128e-002, 8.87901634e-002,
             -5.32292324e-005, 3.69608216e-002, 1.07497133e-001,
             5.30683855e-003, -7.13810772e-002, 1.14707865e-001,
             -1.18747123e-010, 8.23454466e-003, -9.57582816e-002,
             2.11094320e-003, -1.55955078e-002, -1.96184125e-002,
             -7.97872711e-003, 4.55487110e-002, 4.30540033e-002,
             -3.96245904e-002, 1.34776924e-002, -6.69949725e-002,
             1.68104116e-002, -2.63179950e-002, 1.21768368e-002,
             7.13810772e-002, 5.30683855e-003, 1.20832608e-010,
             1.14707865e-001, 1.31312504e-001, -1.62232679e-003,
             -2.14167368e-002, 6.75484017e-002, -8.00662637e-002,
             1.01047279e-002, 7.24480376e-002, -5.52305132e-002,
             -7.89723843e-002, -8.50095376e-002, 8.88728127e-002,
             3.00144330e-002, 1.28885759e-002, 1.08978368e-001,
             -2.31130049e-002, -7.16408268e-002, 1.14707865e-001,
             -9.46841147e-011, 1.08773829e-002, -6.48462325e-002,
             5.46180941e-002, 1.20156594e-002, -6.66885152e-002,
             4.74454984e-002, 9.23098847e-002, -2.76954826e-002,
             3.92485522e-002, 7.78734237e-002, -6.97957203e-002,
             6.63384199e-002, 9.95807350e-003, 8.43466632e-003,
             7.16408268e-002, -2.31130049e-002, 9.69342107e-011,
             1.14707865e-001, 1.13425344e-001, -6.77651167e-003,
             -5.79470815e-003, 5.85625693e-002, -1.10886589e-001,
             1.27254259e-002, 1.24929689e-001, -6.68351948e-002,
             -5.76368235e-002, -5.67884780e-002, 1.00111715e-001,
             1.70725062e-002, 1.59390941e-002, 1.25398174e-001,
             5.30222896e-003, -7.88102746e-002, 1.14707865e-001,
             -1.30626399e-010, 6.62777992e-003, -8.80751163e-002,
             7.41265074e-004, -1.12817427e-002, -2.42129266e-002,
             -1.18621942e-002, 5.21361940e-002, 3.78387496e-002,
             -4.32002209e-002, 1.68815106e-002, -5.88720255e-002,
             2.38249637e-002, -3.46422009e-002, 1.61882453e-002,
             7.88102746e-002, 5.30222896e-003, 1.32932013e-010,
             1.14707865e-001, 1.09014437e-001, 7.81357754e-003,
             3.53390761e-002, -1.14535755e-002, 3.03008333e-002,
             2.89735181e-004, 3.28511074e-002, -2.84388829e-002,
             -3.94113883e-002, -4.85600717e-002, 1.91817544e-002,
             -3.24077606e-002, 1.08258817e-002, 8.82725324e-003,
             6.92879222e-003, 2.49633740e-004, 1.14707865e-001,
             -5.56858943e-012, 2.57136468e-002, -1.69903591e-001,
             -3.36580724e-003, -2.34683026e-002, -7.67660514e-003,
             -3.77656776e-003, -6.47678971e-003, 2.14415640e-002,
             1.72725338e-002, -6.96224067e-003, -1.15609530e-003,
             -4.20660079e-002, 5.49101122e-002, -2.38278732e-002,
             -2.49633740e-004, 6.92879222e-003, 5.52293801e-012,
             1.14707865e-001, 2.07590848e-001, 2.33222097e-002,
             -1.81264907e-001, 5.38626127e-002, 7.62499049e-002,
             -1.40321657e-001, -1.40695229e-001, 7.19809681e-002,
             1.66812375e-001, -2.06615878e-004, -8.15320909e-002,
             1.01399280e-001, -1.89279988e-002, 1.24181956e-001,
             -8.59698951e-002, 7.41588846e-002, 1.14707865e-001,
             1.92666799e-010, 1.36452308e-002, -2.87352242e-002,
             7.27493167e-002, 4.64955047e-002, 4.83315028e-002,
             -4.07654457e-002, -3.61457616e-002, -9.43448693e-002,
             9.89080369e-002, -1.49730951e-001, 2.40339059e-002,
             -4.85213054e-003, -7.78293163e-002, -1.90760251e-002,
             -7.41588846e-002, -8.59698951e-002, -1.94389199e-010,
             1.14707865e-001, -7.51165673e-002, 8.13253317e-003,
             -2.75230501e-002, -8.12550932e-002, -1.61294006e-002,
             -1.02148972e-001, 5.99736609e-002, -2.16671545e-002,
             4.12034765e-002, -3.68309878e-002, 1.08354494e-001,
             3.57210264e-002, -7.04822093e-002, -1.87401287e-002,
             -5.92449121e-002, 7.41239339e-002, 1.14707865e-001,
             1.69592201e-010, 1.57610569e-002, -2.44185682e-002,
             4.99805734e-002, 3.60481888e-002, 3.81127931e-002,
             -3.87912430e-002, -3.96130532e-002, -8.05944428e-002,
             9.97062549e-002, -9.59353074e-002, 1.74028333e-002,
             -5.72775607e-005, -7.55541166e-003, -8.76210332e-002,
             -7.41239339e-002, -5.92449121e-002, -1.71461151e-010,
             1.14707865e-001, -6.20643273e-002, 6.11836370e-003,
             -3.91206630e-002, -8.63938183e-002, -1.72908790e-002,
             -1.02237917e-001, 4.00869474e-002, -3.48132588e-002,
             3.47144455e-002, -3.18840072e-002, 7.73175135e-002,
             5.31329326e-002, -4.52093221e-002, 2.93738884e-003,
             -5.90228215e-002, 6.25857040e-002, 1.14707865e-001,
             1.50945159e-010, 1.13632148e-002, -1.95595305e-002,
             5.18834069e-002, 3.88448648e-002, 3.63684185e-002,
             -3.67126577e-002, -3.37015092e-002, -7.18141645e-002,
             1.01090007e-001, -8.47944692e-002, 1.74409226e-002,
             -3.91821703e-003, -3.30203772e-002, -9.28538889e-002,
             -6.25857040e-002, -5.90228215e-002, -1.52473478e-010,
             1.14707865e-001, -6.34218082e-002, 8.25830735e-003,
             -3.75487208e-002, -8.87213051e-002, -4.34505902e-002,
             -9.99552682e-002, 3.33886407e-002, -2.90526599e-002,
             3.03404126e-002, 2.45061610e-002, 6.67026863e-002,
             2.20496599e-002, 1.13221640e-002, -2.24961173e-002,
             -8.57535303e-002, 6.26327470e-002, 1.14707865e-001,
             1.74044015e-010, 9.22577083e-003, -2.38273628e-002,
             7.54508302e-002, 5.01318388e-002, 4.73886766e-002,
             -3.89282554e-002, -3.06309871e-002, -8.67976174e-002,
             1.01099782e-001, -1.39465734e-001, 2.41146144e-002,
             -1.01627344e-002, -1.00052983e-001, -2.63329949e-002,
             -6.26327470e-002, -8.57535303e-002, -1.75426146e-010,
             1.14707865e-001, -7.66335055e-002, 1.00341691e-002,
             -2.57634390e-002, -8.34058747e-002, -4.20209020e-002,
             -9.99023989e-002, 5.25076725e-002, -1.74021274e-002,
             3.58313620e-002, 2.07186434e-002, 9.94173512e-002,
             8.48388486e-003, -1.08979940e-002, -4.03320976e-002,
             8.30119699e-002, 7.55266249e-002, 1.14707865e-001,
             4.93075754e-011, -7.96137191e-003, 4.03081700e-002,
             -8.59927982e-002, -6.61012232e-002, -3.28354277e-002,
             3.69408727e-002, -4.94771404e-003, 4.29190584e-002,
             -2.92347893e-002, 1.18730344e-001, 1.31010309e-001,
             2.53703110e-002, 1.18521489e-001, 1.42979193e-002,
             -7.55266249e-002, 8.30119699e-002, -5.20035126e-011,
             1.14707865e-001, -9.20287371e-002, -6.61849696e-003,
             -8.32887832e-003, -1.02241375e-001, -6.65980503e-002,
             1.67421792e-002, -3.86228934e-002, -6.15901910e-002,
             -4.45729122e-002, -8.10447261e-002, -5.81738949e-002,
             9.25609469e-002, -1.54950190e-002, 4.15166542e-002,
             5.71743138e-002, 7.50936270e-002, 1.14707865e-001,
             7.08693867e-011, -8.58188048e-003, 2.18426343e-002,
             -6.75112084e-002, -6.27664626e-002, -2.57071853e-002,
             3.51503231e-002, 4.36213362e-004, 3.43838856e-002,
             -2.25160215e-002, 8.09006914e-002, 1.39552519e-001,
             1.67918354e-002, 5.84640279e-002, 6.53420016e-002,
             -7.50936270e-002, 5.71743138e-002, -7.34098407e-011,
             1.14707865e-001, -7.52499923e-002, -2.76981707e-004,
             -2.30436847e-002, -9.84037220e-002, -5.59740514e-002,
             -8.69113114e-003, -3.03853098e-002, -5.88238314e-002,
             -3.40823457e-002, -5.13367280e-002, -6.07971661e-002,
             9.07846242e-002, -2.38073543e-002, 3.23555507e-002,
             5.72569706e-002, 6.40020370e-002, 1.14707865e-001,
             5.30568506e-011, -5.75157581e-003, 2.53028031e-002,
             -6.94212094e-002, -6.21620901e-002, -2.54691839e-002,
             2.95758545e-002, 4.37772833e-003, 3.79949510e-002,
             -2.59393714e-002, 9.16240141e-002, 1.31477281e-001,
             8.85879062e-003, 5.37705608e-002, 6.82416484e-002,
             -6.40020370e-002, 5.72569706e-002, -5.52691504e-011,
             1.14707865e-001, -7.56126344e-002, 3.16312280e-003,
             -2.18280368e-002, -9.80832055e-002, -8.27463269e-002,
             -4.13208152e-004, -3.69402915e-002, -5.40367961e-002,
             -4.03817892e-002, 7.47599639e-003, -7.25189298e-002,
             6.27036542e-002, 2.57997084e-002, 1.29484413e-002,
             8.31122473e-002, 6.44418448e-002, 1.14707865e-001,
             3.14907440e-011, -5.17781358e-003, 4.29434739e-002,
             -8.72605070e-002, -6.69736788e-002, -3.21016349e-002,
             3.10738664e-002, -2.04316340e-003, 4.77375463e-002,
             -3.21143344e-002, 1.30609021e-001, 1.22564860e-001,
             1.70378201e-002, 1.11803330e-001, 1.35083953e-002,
             -6.44418448e-002, 8.31122473e-002, -3.38588289e-011,
             1.14707865e-001, -9.24683064e-002, -3.08729452e-003,
             -7.42106559e-003, -1.02331601e-001, -9.25785229e-002,
             2.46909354e-002, -4.33271527e-002, -5.83145246e-002,
             -5.00180461e-002, -2.06824895e-002, -7.05375522e-002,
             6.27796501e-002, 3.34223732e-002, 2.13130452e-002 );
	e=(Mat_<float>(18,1)<<-1., -1., -1., -1., 2.66358745e-003, 1.87836390e-003,
             7.65952456e-004, 5.97868930e-004, 3.68626497e-004,
             2.66176939e-004, 2.24963151e-004, 1.67779799e-004,
             1.28169384e-004, 1.19866992e-004, 1.15440227e-004,
             1.01563222e-004, 8.23489900e-005, 7.27420556e-005 );
	C= (Mat_<int>(76,2)<< 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9,
             10, 10, 11, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16, 17,
             17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24,
             25, 25, 26, 26, 27, 27, 28, 28, 29, 29, 30, 30, 31, 31, 32,
             32, 33, 33, 34, 34, 35, 35, 36, 36, 37, 37, 38, 38, 39, 39,
             40, 40, 41, 41, 42, 42, 43, 43, 44, 44, 45, 45, 46, 46, 47,
             47, 48, 48, 49, 49, 50, 50, 51, 51, 52, 52, 53, 53, 54, 54,
             55, 55, 56, 56, 57, 57, 58, 58, 59, 59, 60, 60, 61, 61, 62,
             62, 63, 63, 64, 64, 65, 65, 66, 66, 67, 67, 68, 68, 69, 69,
             70, 70, 71, 71, 72, 72, 73, 73, 74, 74, 75, 75, 0 );
	p = Mat::zeros(e.rows,1,CV_32F);
}
//==============================================================================
void 
shape_model::
calc_params(const vector<Point2f> &pts,const Mat weight,const float c_factor)
{
  int n = pts.size(); assert(V.rows == 2*n);
  Mat s = Mat(pts).reshape(1,2*n); //point set to vector format
  if(weight.empty())p = V.t()*s;   //simple projection
  else{                            //scaled projection
    if(weight.rows != n){cout << "Invalid weighting matrix" << endl; abort();}
    int K = V.cols; Mat H = Mat::zeros(K,K,CV_32F),g = Mat::zeros(K,1,CV_32F);
    for(int i = 0; i < n; i++){
      Mat v = V(Rect(0,2*i,K,2)); float w = weight.fl(i);
      H += w*v.t()*v; g += w*v.t()*Mat(pts[i]);
    }
    solve(H,g,p,DECOMP_SVD);
  }this->clamp(c_factor);          //clamp resulting parameters
}
//==============================================================================
Mat
shape_model::
center_shape(const Mat &pts)
{
  int n = pts.rows/2; float mx = 0,my = 0;
  for(int i = 0; i < n; i++){
    mx += pts.fl(2*i); my += pts.fl(2*i+1);
  }  
  Mat p(2*n,1,CV_32F); mx /= n; my /= n;
  for(int i = 0; i < n; i++){
    p.fl(2*i) = pts.fl(2*i) - mx; p.fl(2*i+1) = pts.fl(2*i+1) - my;
  }return p;
}
//==============================================================================
vector<Point2f> 
shape_model::
calc_shape()
{
  Mat s = V*p; int n = s.rows/2; vector<Point2f> pts;
  for(int i = 0; i < n; i++)pts.push_back(Point2f(s.fl(2*i),s.fl(2*i+1)));
  return pts;
}
//==============================================================================
void 
shape_model::
set_identity_params()
{
  p = 0.0; p.fl(0) = 1.0; //1'st parameter is scale
}
//==============================================================================
void
shape_model::
train(const vector<vector<Point2f> > &points,
      const vector<Vec2i> &con,
      const float frac,
      const int kmax)
{
  //vectorize points
  Mat X = this->pts2mat(points);
  int N = X.cols,n = X.rows/2;

  //align shapes
  Mat Y = this->procrustes(X);

  //compute rigid transformation
  Mat R = this->calc_rigid_basis(Y);

  //compute non-rigid transformation
  Mat P = R.t()*Y; Mat dY = Y - R*P; SVD svd(dY*dY.t());
  int m = min(min(kmax,N-1),n-1);
  float vsum = 0; for(int i = 0; i < m; i++)vsum += svd.w.fl(i);
  float v = 0; int k = 0; 
  for(k = 0; k < m; k++){v += svd.w.fl(k); if(v/vsum >= frac){k++; break;}}
  if(k > m)k = m;
  Mat D = svd.u(Rect(0,0,k,2*n));

  //combine bases
  V.create(2*n,4+k,CV_32F);
  Mat Vr = V(Rect(0,0,4,2*n)); R.copyTo(Vr);
  Mat Vd = V(Rect(4,0,k,2*n)); D.copyTo(Vd);

  //compute variance (normalized wrt scale)
  Mat Q = V.t()*X;
  for(int i = 0; i < N; i++){
    float v = Q.fl(0,i); Mat q = Q.col(i); q /= v; 
  }
  e.create(4+k,1,CV_32F);
  pow(Q,2,Q);
  for(int i = 0; i < 4+k; i++){
    if(i < 4)e.fl(i) = -1;
    else e.fl(i) = Q.row(i).dot(Mat::ones(1,N,CV_32F))/(N-1);
  }
  //store connectivity
  if(con.size() > 0){ //default connectivity
    int m = con.size();
    C.create(m,2,CV_32F);
    for(int i = 0; i < m; i++){
      C.at<int>(i,0) = con[i][0]; C.at<int>(i,1) = con[i][1];
    }
  }else{              //user-specified connectivity
    C.create(n,2,CV_32S);
    for(int i = 0; i < n-1; i++){
      C.at<int>(i,0) = i; C.at<int>(i,1) = i+1;
    }    
    C.at<int>(n-1,0) = n-1; C.at<int>(n-1,1) = 0;
  }
}
//==============================================================================
Mat
shape_model::
pts2mat(const vector<vector<Point2f> > &points)
{
  int N = points.size(); assert(N > 0);
  int n = points[0].size();
  for(int i = 1; i < N; i++)assert(int(points[i].size()) == n); 
  Mat X(2*n,N,CV_32F);
  for(int i = 0; i < N; i++){
    Mat x = X.col(i),y = Mat(points[i]).reshape(1,2*n); y.copyTo(x);
  }return X;
}
//==============================================================================
Mat 
shape_model::
procrustes(const Mat &X,
       const int itol,
       const float ftol)
{
  int N = X.cols,n = X.rows/2;

  //remove centre of mass
  Mat P = X.clone();
  for(int i = 0; i < N; i++){
    Mat p = P.col(i);
    float mx = 0,my = 0;
    for(int j = 0; j < n; j++){mx += p.fl(2*j); my += p.fl(2*j+1);}
    mx /= n; my /= n;
    for(int j = 0; j < n; j++){p.fl(2*j) -= mx; p.fl(2*j+1) -= my;}
  }
  //optimise scale and rotation
  Mat C_old;
  for(int iter = 0; iter < itol; iter++){    
    Mat C = P*Mat::ones(N,1,CV_32F)/N; normalize(C,C);
    if(iter > 0){if(norm(C,C_old) < ftol)break;}
    C_old = C.clone();
    for(int i = 0; i < N; i++){
      Mat R = this->rot_scale_align(P.col(i),C);
      for(int j = 0; j < n; j++){
    float x = P.fl(2*j,i),y = P.fl(2*j+1,i);
    P.fl(2*j  ,i) = R.fl(0,0)*x + R.fl(0,1)*y;
    P.fl(2*j+1,i) = R.fl(1,0)*x + R.fl(1,1)*y;
      }
    }
  }return P;
}
//=============================================================================
Mat
shape_model::
rot_scale_align(const Mat &src,
        const Mat &dst)
{
  //construct linear system
  int n = src.rows/2; float a=0,b=0,d=0;
  for(int i = 0; i < n; i++){
    d += src.fl(2*i) * src.fl(2*i  ) + src.fl(2*i+1) * src.fl(2*i+1);
    a += src.fl(2*i) * dst.fl(2*i  ) + src.fl(2*i+1) * dst.fl(2*i+1);
    b += src.fl(2*i) * dst.fl(2*i+1) - src.fl(2*i+1) * dst.fl(2*i  );
  }
  a /= d; b /= d;//solved linear system
  return (Mat_<float>(2,2) << a,-b,b,a);
}
//==============================================================================
Mat
shape_model::
calc_rigid_basis(const Mat &X)
{
  //compute mean shape
  int N = X.cols,n = X.rows/2;
  Mat mean = X*Mat::ones(N,1,CV_32F)/N;

  //construct basis for similarity transform
  Mat R(2*n,4,CV_32F);
  for(int i = 0; i < n; i++){
    R.fl(2*i,0) =  mean.fl(2*i  ); R.fl(2*i+1,0) =  mean.fl(2*i+1);
    R.fl(2*i,1) = -mean.fl(2*i+1); R.fl(2*i+1,1) =  mean.fl(2*i  );
    R.fl(2*i,2) =  1.0;            R.fl(2*i+1,2) =  0.0;
    R.fl(2*i,3) =  0.0;            R.fl(2*i+1,3) =  1.0;
  }
  //Gram-Schmidt orthonormalization
  for(int i = 0; i < 4; i++){
    Mat r = R.col(i);
    for(int j = 0; j < i; j++){
      Mat b = R.col(j); r -= b*(b.t()*r);
    }
    normalize(r,r);
  }return R;
}
//==============================================================================
void
shape_model::
clamp(const float c)
{
  double scale = p.fl(0);
  for(int i = 0; i < e.rows; i++){
    if(e.fl(i) < 0)continue;
    float v = c*sqrt(e.fl(i));
    if(fabs(p.fl(i)/scale) > v){
      if(p.fl(i) > 0)p.fl(i) =  v*scale;
      else           p.fl(i) = -v*scale;
    }
  }
}
//==============================================================================
//void
//shape_model::
//write(FileStorage &fs) const
//{
//  assert(fs.isOpened()); 
//  fs << "{" << "V"  << V << "e"  << e << "C" << C << "}";
//}  
////==============================================================================
//void
//shape_model::
//read(const FileNode& node)
//{
//  assert(node.type() == FileNode::MAP);
//  node["V"] >> V; node["e"] >> e; node["C"] >> C;
//  p = Mat::zeros(e.rows,1,CV_32F);
//}
//==============================================================================
